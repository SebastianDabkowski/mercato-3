@page "/store/{slug}"
@model MercatoApp.Pages.StoreModel
@{
    ViewData["Title"] = Model.Store?.StoreName ?? "Store";
}

@if (Model.Store != null && Model.IsStorePubliclyViewable)
{
    <div class="row">
        <div class="col-lg-8">
            <!-- Store Header -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center mb-3 mb-md-0">
                            @if (!string.IsNullOrEmpty(Model.Store.LogoUrl))
                            {
                                <img src="@Model.Store.LogoUrl" alt="@Model.Store.StoreName Logo" class="img-fluid rounded" style="max-width: 150px; max-height: 150px;" />
                            }
                            else
                            {
                                <div class="border rounded d-flex align-items-center justify-content-center mx-auto" style="width: 150px; height: 150px; background-color: #f8f9fa;">
                                    <span class="h1 text-muted">@(string.IsNullOrEmpty(Model.Store.StoreName) ? "?" : Model.Store.StoreName[0].ToString())</span>
                                </div>
                            }
                        </div>
                        <div class="col-md-9">
                            <h1 class="mb-2">@Model.Store.StoreName</h1>
                            @if (!string.IsNullOrEmpty(Model.Store.Category))
                            {
                                <span class="badge bg-secondary mb-2">@Model.Store.Category</span>
                            }
                            @if (!string.IsNullOrEmpty(Model.Store.Description))
                            {
                                <p class="text-muted mb-0">@Model.Store.Description</p>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Store Description -->
            @if (!string.IsNullOrEmpty(Model.Store.Description))
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">About This Store</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-0">@Model.Store.Description</p>
                    </div>
                </div>
            }

            <!-- Products by Category -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Products</h5>
                </div>
                <div class="card-body">
                    @if (Model.Products.Count == 0)
                    {
                        <p class="text-muted mb-0">No products available yet. Check back soon!</p>
                    }
                    else
                    {
                        @foreach (var category in Model.ProductsByCategory)
                        {
                            <h6 class="border-bottom pb-2 mb-3">
                                <span class="badge bg-secondary">@category.Key</span>
                                <span class="text-muted small">(@category.Value.Count product@(category.Value.Count != 1 ? "s" : ""))</span>
                            </h6>
                            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-4">
                                @foreach (var product in category.Value)
                                {
                                    <div class="col">
                                        <div class="card h-100">
                                            @{
                                                var firstImage = !string.IsNullOrEmpty(product.ImageUrls) 
                                                    ? product.ImageUrls.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries).FirstOrDefault() 
                                                    : null;
                                            }
                                            @if (!string.IsNullOrEmpty(firstImage))
                                            {
                                                <img src="@firstImage" class="card-img-top" alt="@product.Title" style="height: 150px; object-fit: contain;" />
                                            }
                                            else
                                            {
                                                <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 150px;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-box text-muted" viewBox="0 0 16 16">
                                                        <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5 8.186 1.113zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
                                                    </svg>
                                                </div>
                                            }
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <a asp-page="/Product" asp-route-id="@product.Id" class="text-decoration-none stretched-link">@product.Title</a>
                                                </h6>
                                                <p class="card-text text-primary fw-bold mb-1">@product.Price.ToString("C")</p>
                                                <p class="card-text small text-muted">
                                                    @if (product.Stock > 0)
                                                    {
                                                        <span class="text-success">In Stock</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-danger">Out of Stock</span>
                                                    }
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    }
                </div>
            </div>
        </div>

        <!-- Contact Information Sidebar -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Contact Information</h5>
                </div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(Model.Store.ContactEmail) || !string.IsNullOrEmpty(Model.Store.PhoneNumber) || !string.IsNullOrEmpty(Model.Store.WebsiteUrl))
                    {
                        <dl class="mb-0">
                            @if (!string.IsNullOrEmpty(Model.Store.ContactEmail))
                            {
                                <dt>Email</dt>
                                <dd>
                                    <a href="mailto:@Model.Store.ContactEmail">@Model.Store.ContactEmail</a>
                                </dd>
                            }
                            @if (!string.IsNullOrEmpty(Model.Store.PhoneNumber))
                            {
                                <dt>Phone</dt>
                                <dd>
                                    <a href="tel:@Model.Store.PhoneNumber">@Model.Store.PhoneNumber</a>
                                </dd>
                            }
                            @if (!string.IsNullOrEmpty(Model.Store.WebsiteUrl))
                            {
                                <dt>Website</dt>
                                <dd>
                                    <a href="@Model.Store.WebsiteUrl" target="_blank" rel="noopener noreferrer">@Model.Store.WebsiteUrl</a>
                                </dd>
                            }
                        </dl>
                    }
                    else
                    {
                        <p class="text-muted mb-0">No contact information available.</p>
                    }
                </div>
            </div>

            <!-- Store Info -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Store Info</h5>
                </div>
                <div class="card-body">
                    <dl class="mb-0">
                        <dt>Member Since</dt>
                        <dd>@Model.Store.CreatedAt.ToString("MMMM yyyy")</dd>
                        
                        <dt>Status</dt>
                        <dd>
                            @if (Model.Store.Status == MercatoApp.Models.StoreStatus.Active)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else if (Model.Store.Status == MercatoApp.Models.StoreStatus.LimitedActive)
                            {
                                <span class="badge bg-info">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">@Model.Store.Status</span>
                            }
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
}
else if (Model.Store != null && !Model.IsStorePubliclyViewable)
{
    <div class="text-center py-5">
        <div class="mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-shop text-muted" viewBox="0 0 16 16">
                <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zM4 15h3v-5H4v5zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3zm3 0h-2v3h2v-3z"/>
            </svg>
        </div>
        <h2>Store Unavailable</h2>
        <p class="text-muted">@Model.UnavailableMessage</p>
        <a asp-page="/Index" class="btn btn-primary">Go to Home</a>
    </div>
}
else
{
    <div class="text-center py-5">
        <h2>Store Not Found</h2>
        <p class="text-muted">The store you're looking for doesn't exist or is no longer available.</p>
        <a asp-page="/Index" class="btn btn-primary">Go to Home</a>
    </div>
}
